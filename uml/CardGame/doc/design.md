# カードゲームの設計書

## トランプゲーム 戦争

### 要求

- トランプはジョーカーを抜いた52枚で構成する。
- ユーザーとCPUの合計が2名以上で対戦する。
  - ユーザー、CPUをプレイヤーと呼ぶ。
- ゲーム開始時にユーザー人数と各ユーザー名を決める。
- ゲーム開始時にCPUの人数を決める。
- 各プレイヤーはお互いのカードを知ることは出来ない。
- システムが各プレイヤーにカードを1枚ずつ配る。
- 一番大きい数のカードを持つプレイヤーを勝利とする。
- 勝敗が決まったらプログラムを終了する。

### ユースケース

```plantuml
@startuml
left to right direction
actor ユーザー

rectangle 戦争 {
  ユーザー -- (ゲームを始める)
  ユーザー -- (ユーザー人数を決定する)
  ユーザー -- (ユーザー名を決定する)
  ユーザー -- (CPU人数を決定する)
  ユーザー -- (山札をシャッフルさせる)
  ユーザー -- (カードを配らせる)
  ユーザー -- (勝敗を表示する)
  ユーザー -- (ゲームを終了する)
}
@enduml
```

|     名称     |                                       ゲームを始める                                        |
| ------------ | ------------------------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                                    |
| 受動アクター | なし                                                                                        |
| メインフロー | 1. 「ゲームを開始するには何かキーを押してください」というメッセージを表示し入力待ちにする。 |
|              | 2. ユーザーは何かキーを押す。                                                               |
| 例外フロー   | なし                                                                                        |

|     名称     |                                    ユーザー人数を決定する                                     |
| ------------ | ----------------------------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                                        |
| 受動アクター | なし                                                                                            |
| メインフロー | 1. 「ユーザー人数を入力してください:」というメッセージを表示し入力待ちにする。                  |
|              | 2. ユーザーはユーザー人数を入力する。                                                           |
|              | 2. 「ユーザー人数は XX 人です」とメッセージを表示する。                                         |
| 例外フロー   | 入力値が0または53以上の場合、数値以外が含まれている場合は「無効な値です」と表示し再入力させる。 |

|     名称     |                               ユーザー名を決定する                                |
| ------------ | ----------------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                            |
| 受動アクター | なし                                                                                |
| メインフロー | 1. 「ユーザーX人目の名前を入力してください:」というメッセージを表示し入力待ちにする。 |
|              | 2. ユーザーはユーザー名を入力する。                                                 |
|              | 2. 「ユーザーX人目の名前は YYYYYY です」とメッセージを表示する。                      |
| 例外フロー   | 入力文字列が0文字まはた21文字以上の場合は「無効な名前です」と表示し再入力させる。   |

|     名称     |                                                     CPU人数を決定する                                                     |
| ------------ | ------------------------------------------------------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                                                                  |
| 受動アクター | なし                                                                                                                      |
| メインフロー | 1. 「CPU人数を入力してください:」というメッセージを表示し入力待ちにする。                                                 |
|              | 2. ユーザーはユーザー人数を入力する。                                                                                     |
|              | 2. 「CPU人数は XX 人です」とメッセージを表示する。                                                                   |
| 例外フロー   | 入力値とユーザー人数との合計が2未満または53以上の場合、数値以外が含まれている場合は「無効な値です」と表示し再入力させる。 |

|     名称     |                           山札をシャッフルさせる                            |
| ------------ | --------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                    |
| 受動アクター | なし                                                                        |
| メインフロー | 1. 「山札をシャッフルします、何かキーを押してください」というメッセージを表示し入力待ちにする。       |
|              | 2. 何かキーを押す。                                                         |
|              | 2. 山札がシャッフルされ「シャッフルが終わりました」のメッセージを表示する。 |
| 例外フロー   | なし                                                                        |

|     名称     |                                                     カードを配らせる                                                     |
| ------------ | ------------------------------------------------------------------------------------------------------------------------ |
| 能動アクター | ユーザー                                                                                                                 |
| 受動アクター | なし                                                                                                                     |
| メインフロー | 1. 「カードを配ります、何かキーを押してください」とメッセージを表示し入力待ちにする。                                    |
|              | 2. システムがプレイヤー全員に1枚ずつカードを配る。                                                                       |
|              | 3. 「CPUがカードを引きました、お互いの手札を見せあいます。何かキーを押してください」とメッセージを表示し入力待ちにする。 |
| 例外フロー   | なし                                                                                                                     |

|     名称     |                                    勝敗を表示する                                     |
| ------------ | ------------------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                              |
| 受動アクター | なし                                                                                  |
| メインフロー | 1. 「勝敗を表示します。何かキーを押してください」とメッセージを表示し入力待ちにする。 |
|              | 2. 何かキーを押す。                                                                   |
|              | 3. プレイヤー全員の手札から勝敗を判定する                                             |
|              | 4. 「プレイヤー名 : マーク 数値 [勝ち or 負け]」の表示を全プレイヤー分を表示する。           |
| 例外フロー   | なし                                                                                  |

|     名称     |                                    ゲームを終了する                                     |
| ------------ | --------------------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                                |
| 受動アクター | なし                                                                                    |
| メインフロー | 1. 「ゲームを終了します。何かキーを押してください」とメッセージを表示し入力待ちにする。 |
|              | 2. 何かキーを押す。                                                                     |
|              | 3. プログラムを終了する                                                                 |
| 例外フロー   | なし                                                                                    |

### オブジェクト一覧

#### 候補

- ユーザー
- トランプ
- 戦争
- ゲーム
- メッセージ
- キー
- シャッフル
- 山札
- 引く
- プレイヤー
- CPU
- 数
- 手札
- 人数
- 名前

#### 抜擢

- ユーザー
- CPU
- カード
- 山札
- 戦争

### シーケンス図

```plantuml
@startuml

title __ゲームを開始する__

actor ユーザー
activate ユーザー

ユーザー -> 戦争 : ゲームを開始する
activate 戦争

戦争 -> 戦争 : 「ゲームを開始するには何かキーを押してください」\nを画面に表示する
ユーザー <- 戦争 : 入力待ち
ユーザー -> 戦争 : キー入力
deactivate ユーザー

戦争 -> 山札 : 山札を生成
activate 山札
loop 52枚分行う
  山札 -> カード : カード生成
  activate カード
  カード -> カード : 初期化
  山札 <-- カード : カードを返す
  deactivate カード
end
戦争 <-- 山札 : 山札を返す
deactivate 山札

@enduml
```

```plantuml
@startuml

title __ユーザー人数を決定する__

actor ユーザー

[-> 戦争 : ユーザー人数を決定する
activate 戦争

戦争 -> 戦争 : 「ユーザー人数を入力してください:」\nを画面に表示する
ユーザー <- 戦争 : 入力待ち
activate ユーザー
ユーザー -> 戦争 : ユーザー人数を入力
deactivate ユーザー
alt 有効な人数が入力された
  戦争 -> 戦争 : 「ユーザー人数は XX 人です」\nを画面に表示する
else 有効な人数が入力されなかった
  戦争 -> 戦争 : 「無効な値です」\nを画面に表示する
  note right
    有効な値が入力されるまで繰り返す
  end note
end

@enduml
```

```plantuml
@startuml

title __ユーザー名を決定する__

actor ユーザー

[-> 戦争 : ユーザー名を決定する
activate 戦争

loop 全ユーザーの名前の入力が終わるまで
  戦争 -> 戦争 : 「ユーザーX人目の名前を入力してください:」\nを画面に表示する
  ユーザー <- 戦争 : 入力待ち
  activate ユーザー
  ユーザー -> 戦争 : ユーザー名を入力
  deactivate ユーザー
  alt 有効な人数が入力された
    戦争 -> 戦争 : 「ユーザー X の名前は YYYYYY です」\nを画面に表示する
    戦争 -> プレイヤー : プレイヤー生成
    activate プレイヤー
    プレイヤー -> プレイヤー : 初期化
    戦争 <-- プレイヤー : プレイヤーを返す
    deactivate プレイヤー
  else 有効な人数が入力されなかった
    戦争 -> 戦争 : 「無効な値です」\nを画面に表示する
    note right
      有効な名前が入力されるまで繰り返す
    end note
  end
end

@enduml
```

```plantuml
@startuml

title __CPU人数を決定する__

actor ユーザー

[-> 戦争 : CPU人数を決定する
activate 戦争

戦争 -> 戦争 : 「CPU人数を入力してください:」\nを画面に表示する
ユーザー <- 戦争 : 入力待ち
activate ユーザー
ユーザー -> 戦争 : CPU人数を入力
deactivate ユーザー
alt 有効な人数が入力された
  戦争 -> 戦争 : 「CPU人数は XX 人です」\nを画面に表示する
  loop CPU人数分繰り返す
    戦争 -> CPU : CPU生成
    activate CPU
    CPU -> CPU : 初期化
    戦争 <-- CPU : CPUを返す
    deactivate CPU
  end
else 有効な人数が入力されなかった
  戦争 -> 戦争 : 「無効な値です」\nを画面に表示する
  note right
    有効な値が入力されるまで繰り返す
  end note
end

@enduml
```

```plantuml
@startuml

title __山札をシャッフルさせる__

actor ユーザー

[-> 戦争 : 山札をシャッフルさせる
activate 戦争

戦争 -> 戦争 : 「山札をシャッフルします、何かキーを押してください」\nを画面に表示する
ユーザー <- 戦争 : 入力待ち
activate ユーザー
ユーザー -> 戦争 : キーを押す
deactivate ユーザー

戦争 -> 山札 : シャッフルする
activate 山札
deactivate 山札

戦争 -> 戦争 : 「シャッフルが終わりました」\nを画面に表示する

@enduml
```

```plantuml
@startuml

title __カードを配らせる__

actor ユーザー

[-> 戦争 : カードを配らせる
activate 戦争

loop 全プレイヤーにカードを配るまで
  戦争 -> 戦争 : 「カードを配ります、何かキーを押してください」\nを画面に表示する
  ユーザー <- 戦争 : 入力待ち
  activate ユーザー
  ユーザー -> 戦争 : キーを押す
  deactivate ユーザー

  戦争 -> 山札 : カードを引く
  activate 山札
  戦争 <-- 山札 : カードを渡す
  deactivate 山札
  戦争 -> プレイヤー : カードを配る
  activate プレイヤー
  deactivate プレイヤー
end

@enduml
```

```plantuml
@startuml

title __勝敗を表示する__

actor ユーザー

[-> 戦争 : 勝敗を表示する
activate 戦争
戦争 -> 戦争 : 「勝敗を表示します。何かキーを押してください」\nを画面に表示する
ユーザー <- 戦争 : 入力待ち
activate ユーザー
ユーザー -> 戦争 : キー入力
deactivate ユーザー

loop 全プレイヤー分繰り返す
  戦争 -> プレイヤー : 手札を参照する
  activate プレイヤー
  戦争 <-- プレイヤー : 手札の参照を返す
  deactivate プレイヤー
end

戦争 -> 戦争 : 全プレイヤーの手札から勝敗を判定する
戦争 -> 戦争 : 勝敗を画面に表示する
note right
  以下のフォーマットで表示する
    ユーザー1 : spade 10 勝ち
    ユーザー2 : club   2 負け
    CPU1      : club   4 負け
end note

@enduml
```

```plantuml
@startuml

title __ゲームを終了する__

actor ユーザー

[-> 戦争 : ゲームを終了する
activate 戦争
戦争 -> 戦争 : 「ゲームを終了します。何かキーを押してください」\nを画面に表示する
ユーザー <- 戦争 : キー入力待ち
activate ユーザー
ユーザー -> 戦争 : キー入力
deactivate ユーザー


戦争 -> 山札 : 削除
activate 山札
destroy 山札

loop 全プレイヤー分繰り返す
  戦争 -> プレイヤー : 削除
  activate プレイヤー
  destroy プレイヤー
end

戦争 -> 戦争 : ゲーム終了
destroy 戦争

@enduml
```

### クラス図

```plantuml
@startuml

class War {
  - IPlayer players
  - Stack stack
  - void GameStart(void)
  - void DecideNumberOfPlayer(void)
  - void DecideNameOfPlayers(void)
  - void DecideNumberOfCpu(void)
  - void DealCards(void)
  - void AnnounceResult(void)
  - void GameEnd(void)
  + void Run(void)
}
interface IPlayer {
  + void receiveCard(Card Card)
  + Card showCard(void)
}
abstract BasePlayer {
  + String name{readOnly}
  - Card card
}
class Player
class CpuPlayer
class Stack {
  - Card cards[]
  + void shuffle(void)
  + Card take(void)
}
class Card {
  + String suit
  + int number
}

War "1" o--> "1" Stack
War "1" o--> "2..*" IPlayer

BasePlayer -up-|> IPlayer
Player -up-|> BasePlayer
CpuPlayer -up-|> BasePlayer

Stack "1" o--> "*" Card
IPlayer "1" o--> "0..1" Card

War --> Card

@enduml
```
