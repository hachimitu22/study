# カードゲームの設計書

## トランプゲーム 戦争

### 要求

- トランプはジョーカーを抜いた52枚で構成する。
- ユーザーとCPUの2名で対戦する。
- 2名はお互いのカードを知ることは出来ない。
- 2名はカードを1枚ずつ引き数の大きい方を勝利とする。
- 勝敗が決まったらプログラムを終了する。

### ユースケース

```plantuml
@startuml
left to right direction
actor ユーザー

rectangle 戦争 {
  ユーザー -- (ゲームを始める)
  ユーザー -- (プレイヤーがカードを引く)
  ユーザー -- (CPUがカードを引く)
  ユーザー -- (勝敗を表示する)
  ユーザー -- (ゲームを終了する)
}
@enduml
```

|     名称     |                                       ゲームを始める                                        |
| ------------ | ------------------------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                                    |
| 受動アクター | なし                                                                                        |
| メインフロー | 1. 「ゲームを開始するには何かキーを押してください」というメッセージを表示し入力待ちにする。 |
|              | 2. ユーザーは何かキーを押す。                                                               |
|              | 3. カードをシャッフルし山札を用意する。                                                     |
|              | 4. 「カードをシャッフルして山札を用意しました」のメッセージを表示する。                     |
|              | 5. 「カードを引くには何かキーを押してください」とメッセージを表示し入力待ちにする。         |
| 例外フロー   | なし                                                                                        |

|     名称     |                                  プレイヤーがカードを引く                                  |
| ------------ | ------------------------------------------------------------------------------------------ |
| 能動アクター | ユーザー                                                                                   |
| 受動アクター | なし                                                                                       |
| メインフロー | 1. 何かキーを押す。                                                                        |
|              | 2. プレイヤーは山札からカードを一枚引く。                                                  |
|              | 2. 「カードを引きました、数は XX です」とメッセージを表示する。                            |
|              | 3. 「CPUがカードを引きます、何かキーを押してください」とメッセージを表示し入力待ちにする。 |
| 例外フロー   | なし                                                                                       |

|     名称     |                                                    CPUがカードを引く                                                     |
| ------------ | ------------------------------------------------------------------------------------------------------------------------ |
| 能動アクター | ユーザー                                                                                                                 |
| 受動アクター | なし                                                                                                                     |
| メインフロー | 1. 何かキーを押す。                                                                                                      |
|              | 2. CPUが山札からカードを一枚引く。                                                                                       |
|              | 3. 「CPUがカードを引きました、お互いの手札を見せあいます。何かキーを押してください」とメッセージを表示し入力待ちにする。 |
| 例外フロー   | なし                                                                                                                     |

|     名称     |                                     勝敗を表示する                                      |
| ------------ | --------------------------------------------------------------------------------------- |
| 能動アクター | ユーザー                                                                                |
| 受動アクター | なし                                                                                    |
| メインフロー | 1. 何かキーを押す。                                                                     |
|              | 2. プレイヤー と CPU の手札から勝敗を判定する                                           |
|              | 3. 「勝ち プレイヤー XX   CPU YY 負け」のように数、勝敗がわかるメッセージを表示する。   |
|              | 4. 「ゲームを終了します。何かキーを押してください」とメッセージを表示し入力待ちにする。 |
| 例外フロー   | なし                                                                                    |

|     名称     |    ゲームを終了する     |
| ------------ | ----------------------- |
| 能動アクター | ユーザー                |
| 受動アクター | なし                    |
| メインフロー | 1. 何かキーを押す。     |
|              | 2. プログラムを終了する |
| 例外フロー   | なし                    |

#### シナリオ

**ゲームを開始する**  
ユーザーはトランプ戦争ゲームを起動します。起動画面には「ゲーム開始するには何かキーを押してください」とメッセージが表示されています。  
ユーザーは適当なキーを押すと「カードをシャッフルして山札を用意しました」と表示され続けて「カードを引くには何かキーを押してください」というメッセージが表示されました。

**プレイヤーがカードを引く**  
ユーザーはメッセージ通りに適当にキーを押すと「カードを引きました、数は 10 です」と表示され自分の引いたカードを確認します。  
続けて「CPUがカードを引きます、何かキーを押してください」と表示されます。

**CPUがカードを引く**  
ユーザーはメッセージ通りに適当にキーを押すと「CPUがカードを引きました、お互いの手札を見せあいます。何かキーを押してください」と表示されました。  

**勝敗を表示する**  
ユーザーはメッセージ通りに適当にキーを押すと「勝ち ユーザー 10 : CPU 5 負け」と表示されCPUの引いたカードと自分が勝利したことを確認しました。  
画面には「ゲームを終了します。何かキーを押してください」と表示されています。

**ゲームを終了する**  
ユーザーはメッセージ通りに適当にキーを押すとゲームが終了しウィンドウが閉じられました。

### オブジェクト一覧

#### 候補

- ユーザー
- トランプ
- 戦争
- ゲーム
- メッセージ
- キー
- シャッフル
- 山札
- 引く
- プレイヤー
- CPU
- 数
- 手札

#### 抜擢

- ユーザー
- CPU
- カード
- 山札
- ゲーム

#### リネーム

ゲーム -> ゲームコントローラー

### シーケンス図

```plantuml
@startuml

title __ゲームを開始する__

actor ユーザー
activate ユーザー

ユーザー -> ゲームコントローラー : ゲームを開始する
activate ゲームコントローラー

ゲームコントローラー -> ゲームコントローラー : 「ゲームを開始するには何かキーを押してください」\nを画面に表示する
ユーザー <- ゲームコントローラー : 入力待ち
ユーザー -> ゲームコントローラー : キー入力


ゲームコントローラー -> プレイヤー : プレイヤーを生成
activate プレイヤー
プレイヤー -> プレイヤー : 手札を0枚にする
ゲームコントローラー <-- プレイヤー : プレイヤーを返す
deactivate プレイヤー

ゲームコントローラー -> CPU : CPUを生成
activate CPU
CPU -> CPU : 手札を0枚にする
ゲームコントローラー <-- CPU : CPUを返す
deactivate CPU

ゲームコントローラー -> 山札 : 山札を生成
activate 山札
loop 52枚分行う
  山札 -> カード : カード生成
  カード -> カード : カード初期化
  山札 <-- カード : カードを返す
end
山札 -> 山札 : カードをシャッフルする
ゲームコントローラー <-- 山札 : 山札を返す
deactivate 山札

ゲームコントローラー -> ゲームコントローラー :「カードをシャッフルして山札を用意しました」\nを画面に表示する
ゲームコントローラー -> ゲームコントローラー :「カードを引くには何かキーを押してください」\nを画面に表示する
ユーザー <- ゲームコントローラー : キー入力待ち

@enduml
```

```plantuml
@startuml

title __プレイヤーがカードを引く__

actor ユーザー
activate ユーザー

ユーザー -> ゲームコントローラー : キー入力
activate ゲームコントローラー

ゲームコントローラー -> プレイヤー : カードを引かせる
activate プレイヤー
プレイヤー -> 山札 : カードを1枚引く
activate 山札
プレイヤー <-- 山札 : カードを渡す
deactivate 山札
deactivate プレイヤー

ゲームコントローラー -> ゲームコントローラー : 「カードを引きました、数は XX です」\nを画面に表示する
ゲームコントローラー -> ゲームコントローラー : 「CPUがカードを引きます、何かキーを押してください」\nを画面に表示する
ユーザー <- ゲームコントローラー : キー入力待ち

@enduml
```

```plantuml
@startuml

title __CPUがカードを引く__

actor ユーザー
activate ユーザー

ユーザー -> ゲームコントローラー : キー入力
activate ゲームコントローラー

ゲームコントローラー -> CPU : カードを引かせる
activate CPU
CPU -> 山札 : カードを1枚引く
activate 山札
CPU <-- 山札 : カードを渡す
deactivate 山札
deactivate CPU

ゲームコントローラー -> ゲームコントローラー : 「CPUがカードを引きました、お互いの手札を見せあいます。何かキーを押してください」\nを画面に表示する
ユーザー <- ゲームコントローラー : キー入力待ち

@enduml
```

```plantuml
@startuml

title __勝敗を表示する__

actor ユーザー
activate ユーザー

ユーザー -> ゲームコントローラー : キー入力
activate ゲームコントローラー

ゲームコントローラー -> プレイヤー : 手札を参照する
activate プレイヤー
ゲームコントローラー <-- プレイヤー : 手札の参照を返す
deactivate プレイヤー
ゲームコントローラー -> CPU : 手札を参照する
activate CPU
ゲームコントローラー <-- CPU : 手札の参照を返す
deactivate CPU

ゲームコントローラー -> ゲームコントローラー : 勝敗を判定する

alt プレイヤーの勝利
  ゲームコントローラー -> ゲームコントローラー : 「勝ち プレイヤー XX : CPU YY 負け」\nを画面に表示する
else CPUの勝利
  ゲームコントローラー -> ゲームコントローラー : 「負け プレイヤー XX : CPU YY 勝ち」\nを画面に表示する
end

ゲームコントローラー -> ゲームコントローラー : 「ゲームを終了します。何かキーを押してください」\nを画面に表示する
ユーザー <- ゲームコントローラー : キー入力待ち

@enduml
```

```plantuml
@startuml

title __ゲームを終了する__

actor ユーザー
activate ユーザー

ユーザー -> ゲームコントローラー : キー入力
activate ゲームコントローラー

ゲームコントローラー -> プレイヤー : 削除
activate プレイヤー
destroy プレイヤー
ゲームコントローラー -> CPU : 削除
activate CPU
destroy CPU
ゲームコントローラー -> 山札 : 削除
activate 山札
destroy 山札

ユーザー <- ゲームコントローラー : ゲーム終了
destroy ゲームコントローラー

@enduml
```

### クラス図

```plantuml
@startuml

class War {
  - Player player
  - CpuPlayer cpuPlayer
  - Stack trumpStack
  + void GameStart(void)
  + void DrawPlayer(void)
  + void DrawCPU(void)
  + void AnnounceResult(void)
  + void GameEnd(void)
}
abstract BasePlayer {
  - Card card
  + void drawCard(Stack stack)
  + Card takeCardReference(void)
}
class Player
class CpuPlayer
class Stack {
  - Card cards[]
  + Card take(void)
}
class Card {
  + String suit
  + int number
}

War "1" o--> "1" Stack
War "1" o--> "2" BasePlayer

Player -up-|> BasePlayer
CpuPlayer -up-|> BasePlayer

Stack "1" o--> "*" Card
BasePlayer "1" o--> "0..1" Card

BasePlayer -> Stack
War --> Card

@enduml
```
